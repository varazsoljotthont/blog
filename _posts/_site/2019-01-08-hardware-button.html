<p><strong>We use the STM32F429I-DISC1 Discovery kit to test for the LittlevGL hardware button capability. The board have two push-buttons: USER and RESET [1]. We use USER push-button. User button connected to the I/O PA0 of STM32F429ZIT6 [2].  The board have six LEDs. We use LD3 (green LED). The green LED is a user LED connected to the I/O PG13 of the STM32F429ZIT6 [2].</strong></p>

<p>We aim to toggle LD3 LED when both harware button (USER push-pull) and UI button click.</p>

<p>Our hardware button driver register function is</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">my_button_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">lv_indev_t</span> <span class="o">*</span><span class="n">indev</span><span class="p">;</span>
  <span class="n">lv_indev_drv_t</span> <span class="n">indev_drv</span><span class="p">;</span>

  <span class="n">lv_indev_drv_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">indev_drv</span><span class="p">);</span>

  <span class="n">indev_drv</span><span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">my_input_read</span><span class="p">;</span>
  <span class="n">indev_drv</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">LV_INDEV_TYPE_BUTTON</span><span class="p">;</span>
  <span class="n">indev</span> <span class="o">=</span> <span class="n">lv_indev_drv_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">indev_drv</span><span class="p">);</span>

  <span class="k">static</span> <span class="n">lv_point_t</span> <span class="n">points_array</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">};</span>
  <span class="n">lv_indev_set_button_points</span><span class="p">(</span><span class="n">indev</span><span class="p">,</span> <span class="n">points_array</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>where</p>

<ul>
  <li><code class="highlighter-rouge">type</code>: <code class="highlighter-rouge">LV_INDEV_TYPE_BUTTON</code>: External (hardware button) which is assinged to a specific point of the screen</li>
  <li><code class="highlighter-rouge">read</code>: <code class="highlighter-rouge">my_input_read</code> is function for harware button status (press-release).</li>
  <li><code class="highlighter-rouge">points_array</code>: these points will be assigned to the buttons to press a specific point on the screen.</li>
</ul>

<p>We create a button. The <code class="highlighter-rouge">points_array</code>’s first element (20px,20px) is selected any point in the UI button’s area (x: 0-40px, y: 0-40px).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="n">lv_obj_t</span> <span class="o">*</span><span class="n">btn</span> <span class="o">=</span> <span class="n">lv_btn_create</span><span class="p">(</span><span class="n">lv_scr_act</span><span class="p">(),</span> <span class="nb">NULL</span><span class="p">);</span>  
<span class="n">lv_obj_set_size</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
<span class="n">lv_obj_set_pos</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">lv_btn_set_action</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">LV_BTN_ACTION_CLICK</span><span class="p">,</span> <span class="n">btn_click_action</span><span class="p">);</span>
</code></pre></div></div>

<p>Our <code class="highlighter-rouge">btn_click_action</code> toggles only LD3 LED.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="n">lv_res_t</span> <span class="nf">btn_click_action</span><span class="p">(</span><span class="n">lv_obj_t</span> <span class="o">*</span><span class="n">btn</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">GPIOG</span><span class="p">,</span> <span class="n">GPIO_PIN_13</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">my_btn_read</code> function read hardware button data and return hardware button ID.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint8_t</span> <span class="nf">my_btn_read</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">HAL_GPIO_ReadPin</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="n">GPIO_PIN_0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">my_input_read</code> function return <code class="highlighter-rouge">true</code> if there is still data to be read (buffered), otherwise <code class="highlighter-rouge">false</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bool</span> <span class="n">my_input_read</span><span class="p">(</span><span class="n">lv_indev_data_t</span> <span class="o">*</span><span class="n">data</span><span class="p">){</span>
    <span class="k">static</span> <span class="kt">int8_t</span> <span class="n">last_btn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>     <span class="cm">/* Store the last pressed button */</span>
    <span class="kt">int8_t</span> <span class="n">btn_pr</span> <span class="o">=</span> <span class="n">my_btn_read</span><span class="p">();</span>  <span class="cm">/* Get the ID (0,1,2...) of the pressed button */</span>

    <span class="k">if</span><span class="p">(</span><span class="n">btn_pr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                <span class="cm">/* Is there a button press? */</span>
       <span class="n">last_btn</span> <span class="o">=</span> <span class="n">btn_pr</span><span class="p">;</span>           <span class="cm">/* Save the ID of the pressed button */</span>
       <span class="n">data</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">LV_INDEV_STATE_PR</span><span class="p">;</span>  <span class="cm">/* Set the pressed state */</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
       <span class="n">data</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="n">LV_INDEV_STATE_REL</span><span class="p">;</span> <span class="cm">/* Set the released state */</span>
    <span class="p">}</span>

    <span class="n">data</span><span class="o">-&gt;</span><span class="n">btn</span> <span class="o">=</span> <span class="n">last_btn</span><span class="p">;</span>            <span class="cm">/* Set the last button */</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>                    <span class="cm">/* No buffering so no more data read */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In last step we call <code class="highlighter-rouge">button_init</code>.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// GPIO Init: LED, Button</span>
  <span class="c1">// LittlevGL</span>
  <span class="n">button_init</span><span class="p">();</span>

  <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>TODO: Share the complete project</p>

<p>Acknowledgment: We preapare this tutorial with <a href="https://github.com/ogunduz">Orhan Gunduz</a>.</p>

<h3 id="reference">Reference</h3>
<ol>
  <li><a href="http://www.st.com/en/evaluation-tools/32f429idiscovery.html">STM32F429I-DISC1 website</a></li>
  <li><a href="https://www.st.com/content/ccc/resource/technical/document/user_manual/6b/25/05/23/a9/45/4d/6a/DM00093903.pdf/files/DM00093903.pdf/jcr:content/translations/en.DM00093903.pdf">UM1670 User manual Discovery kit with STM32F429ZI MCU</a></li>
  <li><a href="https://github.com/littlevgl/lvgl/issues/567#issuecomment-446586421">LittlevGL issue</a></li>
  <li><a href="https://www.youtube.com/watch?v=dk772McmJs4">Youtube video</a></li>
</ol>
